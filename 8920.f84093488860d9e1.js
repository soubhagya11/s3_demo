"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8920],{78920:(G,d,o)=>{o.r(d),o.d(d,{RollbackModule:()=>x});var m=o(32174),h=o(36895),p=o(24006),b=o(35226),f=o.n(b),u=o(46560),C=o(42786),O=o(75875),e=o(94650);let M=(()=>{class n{authService;constructor(t){this.authService=t}get(t){return new Promise((a,s)=>{this.authService.getApiCall("api/v1/datapublishapi/"+t).subscribe(i=>{a(i)},i=>{s(i)})})}rollback(t,a){return new Promise((s,i)=>{this.authService.putApiCall("api/v1/datapublishapi/"+t,a).subscribe(r=>{s(r)},r=>{i(r)})})}static \u0275fac=function(a){return new(a||n)(e.LFG(O.e))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var g=o(32236),l=o(62510),S=o(46448),c=o(54463),V=o(27601),T=o(2387),R=o(9851),N=o(93875);const I=["masterVersionValid"],B=["versionValid"];function k(n,L){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"app-dropdown-singleselect",14,15),e.NdJ("valueChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.changeMasterVersion(s))}),e.ALo(3,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"ABOUT_US.VERSION")),e.s9C("defaultValue",t.changeMasterVersionId),e.Q6J("options",t.masterVersionDropdown)}}function A(n,L){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"app-dropdown-singleselect",14,16),e.NdJ("valueChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.changeVersion(s))}),e.ALo(3,"translate"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"ABOUT_US.VERSION")),e.s9C("defaultValue",t.changeVersionId),e.Q6J("options",t.versionDropdown)}}let v=(()=>{class n{activatedRoute;generalSettings;loggerService;navigationService;router;rollbackService;translateService;uiUtils;masterVersionValid;versionValid;changeMasterVersionId;changeVersionId;changeVersionName;changemasterVersionName;enableMasterRollback=!0;enterpriseId;latestVersion;masterVersionDropdown=[];maxDataBackupVersions;popupMessage;recordID;rollbackVersion;syncData;syncsettingsData;url;versionDropdown=[];dataJsonObj={};errorObj={};constructor(t,a,s,i,r,j,J,Z){this.activatedRoute=t,this.generalSettings=a,this.loggerService=s,this.navigationService=i,this.router=r,this.rollbackService=j,this.translateService=J,this.uiUtils=Z,this.activatedRoute.params.subscribe(F=>{this.recordID=F.id})}ngOnInit(){this.dataJsonObj.pageName=g.hf.ROLL_BACK,this.enterpriseId=localStorage.getItem(g.BU.SELECTED_ENTERPRISE),this.url=this.router.url.split("/")[4],"masterrollback"===this.url?(this.enableMasterRollback=!0,this.dataJsonObj.pageTitle=[{key:"COMMON_BUTTONS.BUTTON_MASTER_ROLLBACK",value:"",showSubMenuDisplayName:!1}],this.popupMessage=this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_MASTER_ROLLBACK")):(this.enableMasterRollback=!1,this.dataJsonObj.pageTitle=[{key:"COMMON_BUTTONS.BUTTON_ROLLBACK",value:"",showSubMenuDisplayName:!1}],this.popupMessage=this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_ROLLBACK")),this.getAllRecords()}getAllRecords(){this.generalSettings.getgeneralsettings(this.enterpriseId).then(t=>{t.rows[0].configoption_json&&(this.maxDataBackupVersions=t.rows[0].configoption_json.generalConfigOptions.data_backups_preserve_versions?t.rows[0].configoption_json.generalConfigOptions.data_backups_preserve_versions:3,this.getRecordById())})}changeVersion(t){this.changeVersionId=t.value;const a=this.versionDropdown.find(s=>s.ID===parseInt(this.changeVersionId,10));this.changeVersionName=a.NAME}changeMasterVersion(t){this.changeMasterVersionId=t.value;const a=this.masterVersionDropdown.find(s=>s.ID===parseInt(this.changeMasterVersionId,10));this.changemasterVersionName=a.NAME}getRecordById(){this.rollbackService.get(this.recordID).then(t=>{if(this.syncsettingsData=t,this.latestVersion=this.syncsettingsData.last_published_version,this.latestVersion&&this.maxDataBackupVersions&&(this.rollbackVersion=parseInt(this.latestVersion)-parseInt(this.maxDataBackupVersions)),!1===this.enableMasterRollback){let a=this.rollbackVersion;for(let s=0;s<this.rollbackVersion;s++)a+=1,this.versionDropdown.push({ID:a,NAME:a+".0"})}else if(!0===this.enableMasterRollback){let a=0;for(let s=0;s<this.latestVersion;s++)a+=1,this.masterVersionDropdown.push({ID:a,NAME:a+".0"})}})}cancelBtn(){const t=this.navigationService.getPreviousUrl();this.router.navigate([t])}rollbackRecord(){(!0===this.enableMasterRollback?this.masterVersionValid.isValid():this.versionValid.isValid())&&f().fire({title:"",text:this.popupMessage,showCancelButton:!0,cancelButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(t=>{let a={};t.value&&(a=!0===this.enableMasterRollback?{syncId:this.recordID,masterPublishedVersion:this.changemasterVersionName}:{syncId:this.recordID,publishedVersion:this.changeVersionName},this.rollbackService.rollback(this.recordID,a).then(s=>{this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DATA_ROLLBACK"),this.router.routeReuseStrategy.clearModuleRouteCache("datapublish");const r=this.navigationService.getPreviousUrl();this.router.navigate([r])}))}).catch(t=>{this.loggerService.setLoggerError(this.constructor.name,"rollbackRecord",t)})}static \u0275fac=function(a){return new(a||n)(e.Y36(l.gz),e.Y36(u.G),e.Y36(C.m),e.Y36(S.f),e.Y36(l.F0),e.Y36(M),e.Y36(c.sK),e.Y36(V.s))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-rollback"]],viewQuery:function(a,s){if(1&a&&(e.Gf(I,5),e.Gf(B,5)),2&a){let i;e.iGM(i=e.CRH())&&(s.masterVersionValid=i.first),e.iGM(i=e.CRH())&&(s.versionValid=i.first)}},features:[e._Bn([u.G])],decls:16,vars:12,consts:[[1,"container-fluid"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"card-body"],[1,"row","form-bs"],["class","col-md-4",4,"ngIf"],[1,"col-md-6"],["className","btn btn-primary btn-sm",1,"mgr-5",3,"label","buttonOnClick"],["className","btn btn-danger btn-sm",3,"label","buttonOnClick"],[1,"col-md-4"],["disabled","false","mandatory","true","id","appraisal-templates-create-rating-weightage-level-add",3,"label","defaultValue","options","valueChange"],["masterVersionValid",""],["versionValid",""]],template:function(a,s){1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e._UZ(6,"app-pageheader",6),e.qZA(),e.TgZ(7,"div",7)(8,"div",8),e.YNc(9,k,4,5,"div",9),e.YNc(10,A,4,5,"div",9),e.TgZ(11,"div",10)(12,"app-button",11),e.NdJ("buttonOnClick",function(){return s.rollbackRecord()}),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"app-button",12),e.NdJ("buttonOnClick",function(){return s.cancelBtn()}),e.ALo(15,"translate"),e.qZA()()()()()()()()()),2&a&&(e.xp6(6),e.Q6J("pageName",s.dataJsonObj.pageName)("pageTitle",s.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),e.xp6(3),e.Q6J("ngIf",!0===s.enableMasterRollback),e.xp6(1),e.Q6J("ngIf",!1===s.enableMasterRollback),e.xp6(2),e.s9C("label",e.lcZ(13,8,"COMMON_BUTTONS.BUTTON_SUBMIT")),e.xp6(2),e.s9C("label",e.lcZ(15,10,"COMMON_BUTTONS.BUTTON_CANCEL")))},dependencies:[h.O5,T.r,R.k,N.q,c.X$]})}return n})();const D=[{path:"",data:{title:"Build Manager"},children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:":id/rollback",component:v},{path:":id/masterrollback",component:v}]}];let y=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[l.Bz.forChild(D),l.Bz]})}return n})();var E=o(83748),U=o(93144),w=o(44281);let x=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[h.ez,c.aw,p.u5,p.UX,U.U$,m.fx,w.Q,E.v,y]})}return n})()}}]);